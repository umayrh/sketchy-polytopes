version = "0.1"
description = "Python Projects"

buildscript {
    repositories {
        maven {
            url "https://plugins.gradle.org/m2/"
        }
    }
    dependencies {
        classpath "gradle.plugin.com.linkedin.pygradle:pygradle-plugin:0.7.18"
    }
}

subprojects {
    apply plugin: "java-library"
    apply plugin: "idea"
    apply plugin: 'com.linkedin.python'
    apply plugin: 'com.linkedin.python-sdist'
    // TODO: Adding  apply plugin: 'com.linkedin.python-cli'
    // results in buildPex task failure

    idea {
        module {
            sourceDirs += file('src')
            testSourceDirs += file('test')
        }
    }

    repositories {
        pyGradlePyPi()
    }

    // Workaround due to PyGradle's lack of support for native PyPi repos
    task pipInstallRequirements(type: Exec) {
        commandLine "bash", "-c", "source build/venv/bin/activate && pip install -r requirements.txt && deactivate"
    }

    installBuildRequirements.dependsOn pipInstallRequirements
}
