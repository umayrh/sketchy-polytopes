version = "0.1"
description = "Python Projects"

buildscript {
    repositories {
        maven {
            url "https://plugins.gradle.org/m2/"
        }
    }
    dependencies {
        classpath "gradle.plugin.com.linkedin.pygradle:pygradle-plugin:0.7.18"
    }
}

subprojects {
    apply plugin: 'com.linkedin.python'
    apply plugin: "java-library" // for source roots
    apply plugin: "idea"

    idea {
        module {
            sourceDirs += file('src')
            testSourceDirs += file('test')
        }
    }

    repositories {
        pyGradlePyPi()

        ivy {
            url "repo"
            layout 'pattern' , {
                artifact '[organisation]/[module]/[revision]/[artifact]-[revision](-[classifier]).[ext]'
                ivy '[organisation]/[module]/[revision]/[module]-[revision].ivy'
            }
        }
    }

    // Workaround due to PyGradle's lack of support for native PyPi repos
    task pipInstallRequirements(type: Exec) {
        commandLine "bash", "-c", "source build/venv/bin/activate && pip install -r requirements.txt && deactivate"
    }

    installBuildRequirements.dependsOn pipInstallRequirements
}
